import Fynx from 'fynx'
import {requestLocation, updateLocation} from '../services/location'
import Store from '../store'

export const requestLocationById = Fynx.createAsyncAction();

const locationRecieved = Fynx.createAsyncAction();

// Fetch the data
requestLocationById.listen(id => {
  requestLocation(id)
    .then(location => locationRecieved(location));
});

// Store the data
locationRecieved.listen(location =>
  Store.handleMessage({
    type: Store.MessageTypes.Write,
    payload: {
      table: 'locations',
      row: location
    }
  })
);


export const requestUpdateLocation = Fynx.createAction();

requestUpdateLocation.listen((state) => {
  return updateLocation(state.location, state.sameAddress);
});
