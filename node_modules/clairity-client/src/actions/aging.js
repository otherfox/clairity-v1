import Fynx from 'fynx'
import {requestAgingReports, requestAgingReportsSince} from '../services/aging'
import Store from '../store'

export const getAgingReports = Fynx.createAsyncAction();

const agingReportsRecieved = Fynx.createAsyncAction();

// Fetch the data
getAgingReports.listen(date => {
  if (date) {
    alert('Not Yet Implemented');
    requestAgingReportsSince(date);
  } else {
    requestAgingReports()
      .then(reports => agingReportsRecieved(reports));
  }
});

// Store the data
agingReportsRecieved.listen(reports =>
  Store.handleMessage({
    type: Store.MessageTypes.ReplaceAll,
    payload: {
      table: 'agingReports',
      rows: reports.rows
    }
  })
);
